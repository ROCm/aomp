#===--------- libm/Makefile -----------------------------------------------===
#
#                The LLVM Compiler Infrastructure
#
# This file is distributed under the University of Illinois Open Source
# License. See LICENSE.TXT for details.
#
#===----------------------------------------------------------------------===
#
# Makefile:  Makefile to build static device library as archive of bc files
#            written by Greg Rodgers
#
include ../../Makefile.defs

LIBA      = A
LIBA      = B
LIBASRC   = libA
LIBBSRC   = libB

CXX     = $(AOMP)/bin/clang++
CFLAGS  = $(AOMP_CPUTARGET) -fopenmp -fopenmp-targets=$(AOMP_GPUTARGET) \
            -Xopenmp-target=$(AOMP_GPUTARGET) \
            -march=$(AOMP_GPU) -O2

#   ---------------------  create dyn libs -------------------
#
all: libA.so libB.so

libA.so : $(LIBASRC).o
	$(CXX) $(CFLAGS) -shared $^ -o $@ -fPIC

libB.so : $(LIBBSRC).o
	$(CXX) $(CFLAGS) -shared $^ -o $@ -fPIC

$(LIBASRC).o: $(LIBASRC).cpp
	$(CXX) $(CFLAGS) -c $^ -o $@ -fPIC

$(LIBBSRC).o: $(LIBBSRC).cpp
	$(CXX) $(CFLAGS) -c $^ -o $@ -fPIC

clean:
	rm -f *.bc *.ll *.o *.so
