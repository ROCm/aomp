#!/bin/bash
#
#  set_gpu_to_rank: openmpi launch wedge
#
if [ -z "$OMPI_COMM_WORLD_LOCAL_SIZE" ] ; then 
   echo "ERROR: $0 is intended to be run with OpenMPI (mpirun)"
   exit 1
fi
#  TODO Get number of GPUs and FAIL if < OMP_COMM_WORLD_LOCAL_SIZE
AOMP=${AOMP:-/home/grodgers/rocm/aomp}
ROCM_VISIBLE_DEVICES=$OMPI_COMM_WORLD_LOCAL_RANK
export ROCM_VISIBLE_DEVICES
export OMP_NUM_THREADS=1
#echo ROCM_VISIBLE_DEVICES=$ROCM_VISIBLE_DEVICES
$*
exit $?
